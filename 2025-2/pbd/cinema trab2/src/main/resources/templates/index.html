<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{titulo}}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .main-content {
      padding: 40px;
    }

    .back-button {
      display: inline-block;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      margin-bottom: 30px;
      transition: all 0.3s ease;
    }

    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .info-box {
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      border-left: 5px solid;
    }

    .info-box h3 {
      margin-bottom: 10px;
    }

    .info-box p {
      line-height: 1.6;
    }

    .btn {
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:disabled {
      background: #bdc3c7 !important;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c3e50;
    }

    .form-group input,
    .form-group select,
    .form-control {
      width: 100%;
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-control:focus {
      outline: none;
      border-color: #6c5ce7;
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
    }

    .result-box {
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      display: none;
    }

    .result-box.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result-box.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 18px 15px;
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9em;
      letter-spacing: 0.5px;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      color: #333;
    }

    tr:hover {
      background-color: #f8f9fa;
      transition: background-color 0.2s ease;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state h3 {
      margin-bottom: 15px;
      color: #7f8c8d;
    }

    .empty-state p {
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-card h4 {
      font-size: 2em;
      margin-bottom: 5px;
    }

    .stat-card p {
      opacity: 0.9;
    }

    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      color: #856404;
    }

    .warning h5 {
      margin-bottom: 5px;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 20px;
      }

      .stats {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 2em;
      }
    }

    .header {
      background: linear-gradient(45deg, #ff6b6b, #ffa500);
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }

    .feature-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      border-left: 5px solid;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }

    .feature-card.req1 {
      border-color: #ff6b6b;
    }

    .feature-card.req2 {
      border-color: #4ecdc4;
    }

    .feature-card.req3 {
      border-color: #45b7d1;
    }

    .feature-card.req4 {
      border-color: #f9ca24;
    }

    .feature-card.req5 {
      border-color: #6c5ce7;
    }

    .feature-card h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.4em;
    }

    .feature-card p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .feature-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-primary {
      background: linear-gradient(45deg, #667eea, #764ba2);
    }

    .btn-secondary {
      background: #ecf0f1;
      color: #2c3e50;
      border: 1px solid #bdc3c7;
    }

    .footer {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 20px;
      margin-top: 40px;
    }

    .api-endpoint {
      background: #f5f5f5;
      border-left: 4px solid #3498db;
      padding: 10px 15px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #2c3e50;
    }

    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üé¨ {{titulo}}</h1>
      <p>Sistema completo para gerenciamento de cinema com funcionalidades avan√ßadas</p>
    </div>

    <div class="main-content">
      <div class="features-grid">
        <div class="feature-card req1">
          <h3>üìä Relat√≥rio de Clientes Frequentes</h3>
          <p>Gera relat√≥rio com clientes que compraram ingressos em pelo menos 2 sess√µes diferentes, incluindo CPF,
            nome, quantidade de ingressos, total gasto e valor m√©dio por ingresso.</p>
          <div class="feature-buttons">
            <a href="/relatorio/clientes-frequentes/view" class="btn btn-primary">Ver Relat√≥rio</a>
            <a href="/relatorio/clientes-frequentes" class="btn btn-secondary">JSON API</a>
          </div>
          <div class="api-endpoint">GET /relatorio/clientes-frequentes</div>
        </div>

        <div class="feature-card req2">
          <h3>‚ö†Ô∏è Conflitos de Sess√µes</h3>
          <p>Verifica conflitos de hor√°rio para sess√µes do mesmo filme em salas diferentes. Identifica sess√µes que
            iniciam simultaneamente causando poss√≠veis problemas operacionais.</p>
          <div class="feature-buttons">
            <a href="/sessoes/conflitos/view" class="btn btn-primary">Ver Conflitos</a>
            <a href="/sessoes/conflitos" class="btn btn-secondary">JSON API</a>
          </div>
          <div class="api-endpoint">GET /sessoes/conflitos</div>
        </div>

        <div class="feature-card req3">
          <h3>üéØ Simula√ß√£o de Ocupa√ß√£o</h3>
          <p>Simula a ocupa√ß√£o futura de uma sess√£o baseada em percentual informado. Insere ingressos simulados e
            retorna o n√∫mero de poltronas que seriam ocupadas.</p>
          <div class="feature-buttons">
            <a href="/sessoes/simular" class="btn btn-primary">Simular Ocupa√ß√£o</a>
            <button onclick="exemploSimulacao()" class="btn btn-secondary">Exemplo API</button>
          </div>
          <div class="api-endpoint">POST /sessoes/{id}/simular-ocupacao</div>
        </div>

        <div class="feature-card req4">
          <h3>üí∞ Ajuste de Pre√ßos</h3>
          <p>Ajusta automaticamente os pre√ßos de sess√µes com baixa ocupa√ß√£o (< 30%) reduzindo 20% do valor quando falta
              at√© 1 hora para o in√≠cio da sess√£o.</p>
              <div class="feature-buttons">
                <button onclick="ajustarPrecos()" class="btn btn-primary">Ajustar Pre√ßos</button>
                <a href="/sessoes" class="btn btn-secondary">Ver Sess√µes</a>
              </div>
              <div class="api-endpoint">POST /sessoes/ajustar-precos</div>
        </div>

        <div class="feature-card req5">
          <h3>ü™ë Remanejamento de Poltronas</h3>
          <p>Permite remanejar um cliente de uma poltrona para outra dentro da mesma sess√£o. Verifica disponibilidade,
            atualiza o ingresso e gera log do remanejamento.</p>
          <div class="feature-buttons">
            <a href="/ingressos/remanejar" class="btn btn-primary">Remanejar</a>
            <button onclick="exemploRemanejamento()" class="btn btn-secondary">Exemplo API</button>
          </div>
          <div class="api-endpoint">POST /ingressos/remanejar</div>
        </div>

        <div class="feature-card req1" style="border-color: #e74c3c;">
          <h3>üé´ Vender Ingresso</h3>
          <p>Vende ingressos para sess√µes verificando disponibilidade de poltronas e capacidade da sala. Impede venda
            de assentos j√° ocupados e ultrapassagem da capacidade m√°xima.</p>
          <div class="feature-buttons">
            <a href="/ingressos/vender" class="btn btn-primary">Vender Ingresso</a>
            <button onclick="exemploVenderIngresso()" class="btn btn-secondary">Exemplo API</button>
          </div>
          <div class="api-endpoint">POST /ingressos/vender</div>
        </div>

        <div class="feature-card req2" style="border-color: #27ae60;">
          <h3>üí∫ Assentos Dispon√≠veis</h3>
          <p>Lista todos os assentos dispon√≠veis para uma sess√£o espec√≠fica. Mostra fileira, n√∫mero e tipo de poltrona
            que ainda podem ser vendidas.</p>
          <div class="feature-buttons">
            <a href="/assentos/disponiveis" class="btn btn-primary">Ver Assentos</a>
            <button onclick="exemploAssentosDisponiveis()" class="btn btn-secondary">Exemplo API</button>
          </div>
          <div class="api-endpoint">GET /sessoes/{id}/assentos-disponiveis</div>
        </div>

        <div class="feature-card req3" style="border-color: #f39c12;">
          <h3>üìà Relat√≥rio de Ocupa√ß√£o</h3>
          <p>Gera relat√≥rio detalhado de ocupa√ß√£o de uma sess√£o incluindo capacidade da sala, ingressos vendidos,
            percentual de ocupa√ß√£o e informa√ß√µes do filme.</p>
          <div class="feature-buttons">
            <a href="/relatorio/ocupacao" class="btn btn-primary">Ver Relat√≥rio</a>
            <button onclick="exemploRelatorioOcupacao()" class="btn btn-secondary">Exemplo API</button>
          </div>
          <div class="api-endpoint">GET /sessoes/{id}/relatorio-ocupacao</div>
        </div>
      </div>

      <div style="margin-top: 40px;">
        <h3 style="color: #2c3e50; margin-bottom: 20px;">üîß Funcionalidades Auxiliares</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <a href="/sessoes" class="btn btn-secondary">üìÖ Listar Sess√µes</a>
          <button onclick="cadastrarCliente()" class="btn btn-secondary">üë§ Cadastrar Cliente</button>
          <button onclick="verificarOcupacao()" class="btn btn-secondary">üìä Ver Ocupa√ß√£o</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>üéì Trabalho 2 - Programa√ß√£o para Banco de Dados</p>
      <p>Sistema desenvolvido com Javalin + PostgreSQL + Fun√ß√µes/Triggers</p>
    </div>
  </div>

  <script>
    function ajustarPrecos() {
      if (confirm('Deseja ajustar os pre√ßos de todas as sess√µes com baixa ocupa√ß√£o?')) {
        fetch('/sessoes/ajustar-precos', { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            alert(`Sucesso! ${data.ingressos_ajustados} ingressos tiveram seus pre√ßos ajustados.`);
          })
          .catch(error => {
            alert('Erro ao ajustar pre√ßos: ' + error);
          });
      }
    }

    function exemploSimulacao() {
      const sessaoId = prompt('Digite o ID da sess√£o:');
      const percentual = prompt('Digite o percentual de ocupa√ß√£o (0-100):');

      if (sessaoId && percentual) {
        fetch(`/sessoes/${sessaoId}/simular-ocupacao`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ percentual: parseFloat(percentual) })
        })
          .then(response => response.json())
          .then(data => {
            if (data.sucesso) {
              alert(`Simula√ß√£o conclu√≠da! ${data.poltronas_ocupadas} poltronas foram ocupadas (${data.percentual_simulado}%).`);
            } else {
              alert('Erro: ' + data.erro);
            }
          })
          .catch(error => alert('Erro: ' + error));
      }
    }

    function exemploRemanejamento() {
      const cpf = prompt('Digite o CPF do cliente:');
      const sessaoId = prompt('Digite o ID da sess√£o:');
      const poltronaAntiga = prompt('Digite o ID da poltrona atual:');
      const poltronaNova = prompt('Digite o ID da nova poltrona:');

      if (cpf && sessaoId && poltronaAntiga && poltronaNova) {
        fetch('/ingressos/remanejar', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            cpf: cpf,
            sessao_id: parseInt(sessaoId),
            poltrona_antiga: parseInt(poltronaAntiga),
            poltrona_nova: parseInt(poltronaNova)
          })
        })
          .then(response => response.json())
          .then(data => {
            alert(data.mensagem);
          })
          .catch(error => alert('Erro: ' + error));
      }
    }

    function verificarOcupacao() {
      const sessaoId = prompt('Digite o ID da sess√£o:');
      if (sessaoId) {
        fetch(`/sessoes/${sessaoId}/ocupacao`)
          .then(response => response.json())
          .then(data => {
            alert(`Ocupa√ß√£o da sess√£o ${data.sessao_id}: ${data.percentual_ocupacao?.toFixed(2)}%`);
          })
          .catch(error => alert('Erro: ' + error));
      }
    }

    function exemploVenderIngresso() {
      const cpf = prompt('Digite o CPF do cliente:');
      const sessaoId = prompt('Digite o ID da sess√£o:');
      const poltronaId = prompt('Digite o ID da poltrona:');
      const valor = prompt('Digite o valor do ingresso:');

      if (cpf && sessaoId && poltronaId && valor) {
        fetch('/ingressos/vender', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            cpf: cpf,
            sessao_id: parseInt(sessaoId),
            poltrona_id: parseInt(poltronaId),
            valor: parseFloat(valor)
          })
        })
          .then(response => response.json())
          .then(data => {
            alert(data.mensagem);
          })
          .catch(error => alert('Erro: ' + error));
      }
    }

    function exemploAssentosDisponiveis() {
      const sessaoId = prompt('Digite o ID da sess√£o:');
      if (sessaoId) {
        fetch(`/sessoes/${sessaoId}/assentos-disponiveis`)
          .then(response => response.json())
          .then(data => {
            if (data.length > 0) {
              const assentos = data.map(a => `${a.fileira}${a.numero}`).join(', ');
              alert(`Assentos dispon√≠veis: ${assentos}`);
            } else {
              alert('Nenhum assento dispon√≠vel');
            }
          })
          .catch(error => alert('Erro: ' + error));
      }
    }

    function exemploRelatorioOcupacao() {
      const sessaoId = prompt('Digite o ID da sess√£o:');
      if (sessaoId) {
        fetch(`/sessoes/${sessaoId}/relatorio-ocupacao`)
          .then(response => response.json())
          .then(data => {
            alert(`Relat√≥rio da sess√£o ${data.sessaoId}:
Filme: ${data.tituloFilme}
Sala: ${data.salaId}
Capacidade: ${data.capacidade}
Ocupados: ${data.ocupados}
Percentual: ${data.percentual?.toFixed(1)}%`);
          })
          .catch(error => alert('Erro: ' + error));
      }
    }

    function cadastrarCliente() {
      const cpf = prompt('CPF:');
      const nome = prompt('Nome:');
      const email = prompt('Email:');
      const telefone = prompt('Telefone:');

      if (cpf && nome) {
        fetch('/clientes', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cpf, nome, email, telefone })
        })
          .then(response => response.json())
          .then(data => alert(data.mensagem || data.erro))
          .catch(error => alert('Erro: ' + error));
      }
    }
  </script>
</body>

</html>