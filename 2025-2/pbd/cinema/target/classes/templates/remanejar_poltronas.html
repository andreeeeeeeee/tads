<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{titulo}}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .main-content {
      padding: 40px;
    }

    .back-button {
      display: inline-block;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      margin-bottom: 30px;
      transition: all 0.3s ease;
    }

    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .info-box {
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      border-left: 5px solid;
    }

    .info-box h3 {
      margin-bottom: 10px;
    }

    .info-box p {
      line-height: 1.6;
    }

    .btn {
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:disabled {
      background: #bdc3c7 !important;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c3e50;
    }

    .form-group input,
    .form-group select,
    .form-control {
      width: 100%;
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-control:focus {
      outline: none;
      border-color: #6c5ce7;
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
    }

    .result-box {
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      display: none;
    }

    .result-box.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result-box.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 18px 15px;
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.9em;
      letter-spacing: 0.5px;
    }

    td {
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      color: #333;
    }

    tr:hover {
      background-color: #f8f9fa;
      transition: background-color 0.2s ease;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state h3 {
      margin-bottom: 15px;
      color: #7f8c8d;
    }

    .empty-state p {
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-card h4 {
      font-size: 2em;
      margin-bottom: 5px;
    }

    .stat-card p {
      opacity: 0.9;
    }

    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      color: #856404;
    }

    .warning h5 {
      margin-bottom: 5px;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 20px;
      }

      .stats {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 2em;
      }
    }

    .header {
      background: linear-gradient(45deg, #6c5ce7, #5f27cd);
    }

    .info-box {
      background: #f3e5f5;
      border-color: #9c27b0;
    }

    .info-box h3 {
      color: #7b1fa2;
    }

    .info-box p {
      color: #8e24aa;
    }

    .form-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .btn {
      background: linear-gradient(45deg, #6c5ce7, #5f27cd);
      width: 100%;
    }

    .steps {
      background: white;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 20px;
      border-left: 5px solid #6c5ce7;
    }

    .steps h4 {
      color: #2c3e50;
      margin-bottom: 15px;
    }

    .step-list {
      list-style: none;
      counter-reset: step-counter;
    }

    .step-list li {
      counter-increment: step-counter;
      margin-bottom: 10px;
      padding-left: 30px;
      position: relative;
      color: #555;
    }

    .step-list li::before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      background: #6c5ce7;
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>ü™ë {{titulo}}</h1>
      <p>Remanejar cliente para uma nova poltrona na mesma sess√£o</p>
    </div>

    <div class="main-content">
      <a href="/" class="back-button">‚Üê Voltar ao Menu Principal</a>

      <div class="info-box">
        <h3>üîÑ Como Funciona o Remanejamento</h3>
        <p>Esta ferramenta permite remanejar um cliente de uma poltrona para outra dentro da mesma sess√£o.
          O sistema verifica se a nova poltrona est√° dispon√≠vel, atualiza o ingresso e gera um log completo do
          remanejamento
          para controle e auditoria.</p>
      </div>

      <div class="steps">
        <h4>üìã Processo de Remanejamento</h4>
        <ol class="step-list">
          <li>Verifica√ß√£o da exist√™ncia do ingresso para o CPF e poltrona atual</li>
          <li>Valida√ß√£o da disponibilidade da nova poltrona</li>
          <li>Atualiza√ß√£o do ingresso com a nova poltrona</li>
          <li>Gera√ß√£o de log com todas as informa√ß√µes do remanejamento</li>
        </ol>
      </div>

      <div class="warning">
        <h5>‚ö†Ô∏è Aten√ß√£o</h5>
        <p>Certifique-se de que todos os dados estejam corretos antes de executar o remanejamento.
          Esta opera√ß√£o n√£o pode ser desfeita automaticamente.</p>
      </div>

      <div class="form-section">
        <h3 style="margin-bottom: 25px; color: #2c3e50;">üìù Dados do Remanejamento</h3>

        <form id="remanejamentoForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="cpf">CPF do Cliente</label>
              <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14" oninput="formatarCPF(this)">
            </div>

            <div class="form-group">
              <label for="sessaoId">ID da Sess√£o</label>
              <input type="number" id="sessaoId" placeholder="Ex: 1" min="1">
            </div>

            <div class="form-group">
              <label for="poltronaAntiga">ID da Poltrona Atual</label>
              <input type="number" id="poltronaAntiga" placeholder="Ex: 15" min="1">
            </div>

            <div class="form-group">
              <label for="poltronaNova">ID da Nova Poltrona</label>
              <input type="number" id="poltronaNova" placeholder="Ex: 20" min="1">
            </div>
          </div>

          <button type="submit" class="btn" id="remanejarBtn">
            Executar Remanejamento
          </button>
        </form>

        <div id="resultBox" class="result-box">
          <h4 id="resultTitle"></h4>
          <p id="resultMessage"></p>
          <div id="resultDetails" style="margin-top: 15px; font-family: 'Courier New', monospace; font-size: 0.9em;">
          </div>
        </div>
      </div>

      <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
        <h4 style="margin-bottom: 15px; color: #2c3e50;">üîß API do Remanejamento</h4>
        <div style="font-family: 'Courier New', monospace; font-size: 0.9em; color: #666;">
          <p><strong>Endpoint:</strong> <span style="color: #6c5ce7;">POST /ingressos/remanejar</span></p>
          <p><strong>Body:</strong></p>
          <pre style="background: white; padding: 10px; border-radius: 4px; margin-top: 5px;">{
  "cpf": "12345678901",
  "sessao_id": 1,
  "poltrona_antiga": 15,
  "poltrona_nova": 20
}</pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    function formatarCPF(input) {
      let valor = input.value.replace(/\D/g, '');

      if (valor.length <= 11) {
        valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
        valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
        valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      }

      input.value = valor;
    }

    document.getElementById('remanejamentoForm').addEventListener('submit', function (e) {
      e.preventDefault();
      executarRemanejamento();
    });

    function executarRemanejamento() {
      const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
      const sessaoId = document.getElementById('sessaoId').value;
      const poltronaAntiga = document.getElementById('poltronaAntiga').value;
      const poltronaNova = document.getElementById('poltronaNova').value;

      if (!cpf || cpf.length !== 11) {
        mostrarResultado('error', 'CPF Inv√°lido', 'Por favor, digite um CPF v√°lido com 11 d√≠gitos.');
        return;
      }

      if (!sessaoId || !poltronaAntiga || !poltronaNova) {
        mostrarResultado('error', 'Dados Incompletos', 'Por favor, preencha todos os campos.');
        return;
      }

      if (poltronaAntiga === poltronaNova) {
        mostrarResultado('error', 'Poltronas Iguais', 'A poltrona atual e a nova devem ser diferentes.');
        return;
      }

      const btn = document.getElementById('remanejarBtn');
      btn.disabled = true;
      btn.textContent = 'Processando...';

      const dados = {
        cpf: cpf,
        sessao_id: parseInt(sessaoId),
        poltrona_antiga: parseInt(poltronaAntiga),
        poltrona_nova: parseInt(poltronaNova)
      };

      fetch('/ingressos/remanejar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(dados)
      })
        .then(response => response.json())
        .then(data => {
          if (data.sucesso) {
            mostrarResultado('success', 'Remanejamento Realizado!', data.mensagem, dados);
            document.getElementById('remanejamentoForm').reset();
          } else {
            mostrarResultado('error', 'Falha no Remanejamento', data.erro || data.mensagem, dados);
          }
        })
        .catch(error => {
          mostrarResultado('error', 'Erro na Requisi√ß√£o', 'Erro ao comunicar com o servidor: ' + error);
        })
        .finally(() => {
          btn.disabled = false;
          btn.textContent = 'Executar Remanejamento';
        });
    }

    function mostrarResultado(tipo, titulo, mensagem, dados = null) {
      const resultBox = document.getElementById('resultBox');
      const resultTitle = document.getElementById('resultTitle');
      const resultMessage = document.getElementById('resultMessage');
      const resultDetails = document.getElementById('resultDetails');

      resultBox.className = `result-box ${tipo}`;
      resultBox.style.display = 'block';
      resultTitle.textContent = titulo;
      resultMessage.textContent = mensagem;

      if (dados && tipo === 'success') {
        resultDetails.innerHTML = `
                    <strong>Detalhes do Remanejamento:</strong><br>
                    ‚Ä¢ CPF: ${dados.cpf}<br>
                    ‚Ä¢ Sess√£o: ${dados.sessao_id}<br>
                    ‚Ä¢ Poltrona Anterior: ${dados.poltrona_antiga}<br>
                    ‚Ä¢ Nova Poltrona: ${dados.poltrona_nova}<br>
                    ‚Ä¢ Status: Conclu√≠do
                `;
      } else {
        resultDetails.innerHTML = '';
      }

      resultBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  </script>
</body>

</html>